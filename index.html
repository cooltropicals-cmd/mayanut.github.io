<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>MayaNut AI</title>
  <style>
    body{
      margin:0;height:100vh;background:linear-gradient(to bottom,#a8edea 0%,#fed6e3 100%);
      color:#222;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;
      display:flex;flex-direction:column;align-items:center;justify-content:flex-start;overflow:hidden;position:relative
    }
    .navbar{width:100%;display:flex;justify-content:center;gap:30px;padding:14px 0;background:rgba(255,255,255,.9);
      border-bottom:1px solid #ddd;position:fixed;top:0;left:0;z-index:10}
    .nav-item{color:#333;font-weight:600;font-size:16px;padding:8px 14px;border-radius:6px;text-decoration:none;transition:background .2s}
    .nav-item:hover{background:#f0f0f0}
    .logo{position:absolute;top:15px;left:20px;font-size:26px;font-weight:700;color:#1a1a1a}
    .logo sup{font-size:10px;vertical-align:top;margin-left:2px}
    .chat-box{margin-top:100px;width:560px;max-width:92%;background:rgba(255,255,255,.92);border-radius:12px;padding:20px;
      box-shadow:0 0 20px rgba(0,0,0,.08);display:flex;flex-direction:column;gap:10px}
    .chat-log{display:block;text-align:left;max-height:360px;overflow-y:auto;padding:12px;background:rgba(240,240,240,.85);
      border-radius:8px;font-size:16px;line-height:1.6;color:#333}
    .chat-input{width:100%;padding:12px;border:1px solid #ddd;border-radius:6px;outline:none;font-size:15px;color:#333}
    .pill{display:inline-block;margin:.25rem 0;padding:.15rem .5rem;border:1px solid #ddd;border-radius:999px;background:#f5f5f5;font-size:12px;color:#555;cursor:pointer}
    .hint{font-size:12px;color:#666}
    .hidden-products,.hidden-about{display:none;margin-top:20px;text-align:left;padding:10px;background:rgba(255,255,255,.75);
      border-radius:8px;width:560px;max-width:92%}
    .hidden-products ul{padding-left:20px}
    @media (max-width:700px){.chat-log{max-height:300px}}
  </style>
</head>
<body>
  <!-- Dashboard -->
  <div class="navbar">
    <a href="#" class="nav-item" id="aiTab">MayaNut AI</a>
    <a href="#" class="nav-item" id="productsTab">Products</a>
    <a href="#" class="nav-item" id="aboutTab">About MayaNut</a>
  </div>

  <!-- Logo -->
  <div class="logo">MayaNut<sup>™</sup></div>

  <!-- Chat -->
  <div class="chat-box" id="chatBox">
    <div class="chat-log" id="chatLog"></div>
    <input type="text" id="chatInput" class="chat-input" placeholder="Ask what you want to buy"/>
    <div class="hint">
      Teach me with: <code>remember: ...</code> • <code>fact: ...</code> • <code>product: Name = details</code> • View: <code>memories</code> • Delete: <code>forget 2</code>
    </div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <span class="pill" data-quick="buy">Buy MayaNut Products</span>
      <span class="pill" data-quick="about company">About Us</span>
      <span class="pill" data-quick="instagram">Instagram</span>
    </div>
  </div>

  <!-- Hidden product page -->
  <div class="hidden-products" id="productPage">
    <h3>MayaNut Products</h3>
    <ul id="productList">
      <!-- Will render from memory + defaults -->
    </ul>
  </div>

  <!-- Hidden about page -->
  <div class="hidden-about" id="aboutPage">
    <h3>About MayaNut</h3>
    <p>MayaNut was founded on April 24, 2008 to ensure the survival of the <em>Brosimum alicastrum</em> species and to benefit humanity through its agricultural uses.</p>
    <p><em>Brosimum alicastrum</em> (Maya Nut / Breadnut) is a tropical rainforest tree in the Moraceae family (relatives of fig, jackfruit, mulberry). In modern agroforestry it’s valued for high productivity, drought resilience, shade canopy services, and nutrient-dense seeds that support people and ecosystems.</p>
  </div>

  <script>
    /* ======= CORE BELIEF ======= */
    const CORE_BELIEF = "Core belief: Preserve and promote the long-term survival of Brosimum alicastrum (Maya Nut) through responsible use in agriculture and community benefit.";

    /* ======= MEMORY (localStorage) ======= */
    const MEM_KEY = "mayanut_memory_v1";
    function loadMem(){
      const raw = localStorage.getItem(MEM_KEY);
      if(raw){ try { return JSON.parse(raw); } catch(e){ /* ignore */ } }
      // initial memory with 3 placeholder products
      return {
        facts: [
          {text: CORE_BELIEF, ts: Date.now()}
        ],
        products: {
          "MayaNut Flour":"Placeholder: gluten-free flour for baking.",
          "MayaNut Roasted Drink":"Placeholder: caffeine-free roasted beverage.",
          "MayaNut Energy Bites":"Placeholder: wholesome snack bites."
        }
      };
    }
    function saveMem(mem){ localStorage.setItem(MEM_KEY, JSON.stringify(mem)); }
    let MEMORY = loadMem();

    /* ======= RENDER PRODUCTS ======= */
    function renderProductsList(){
      const ul = document.getElementById("productList");
      ul.innerHTML = "";
      Object.keys(MEMORY.products).forEach(name=>{
        const li = document.createElement("li");
        li.textContent = `${name} — ${MEMORY.products[name]}`;
        ul.appendChild(li);
      });
    }
    renderProductsList();

    /* ======= TEXT UTILS + FUZZY ======= */
    const norm = s => (s||"").toLowerCase().normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim();
    function lev(a,b){
      const m=a.length,n=b.length; if(Math.abs(m-n)>2) return 99;
      const dp=Array.from({length:m+1},(_,i)=>Array(n+1).fill(0));
      for(let i=0;i<=m;i++) dp[i][0]=i; for(let j=0;j<=n;j++) dp[0][j]=j;
      for(let i=1;i<=m;i++){ for(let j=1;j<=n;j++){
        const cost=a[i-1]===b[j-1]?0:1;
        dp[i][j]=Math.min(dp[i-1][j]+1,dp[i][j-1]+1,dp[i-1][j-1]+cost);
      }} return dp[m][n];
    }
    function fuzzyIncludes(text, keywords){
      const t = norm(text), tokens = t.split(" ");
      for(const kw of keywords){
        const k = norm(kw);
        if(t.includes(k)) return true;
        const kTokens = k.split(" ");
        if(kTokens.length===1){
          for(const tok of tokens){ if(lev(tok,k)<=2) return true; }
        } else {
          for(let i=0;i<=tokens.length-kTokens.length;i++){
            let ok=true; for(let j=0;j<kTokens.length;j++){ if(lev(tokens[i+j],kTokens[j])>2){ok=false;break;} }
            if(ok) return true;
          }
        }
      }
      return false;
    }

    /* ======= KNOWLEDGE & TRIGGERS ======= */
    const mayaSynonyms = [
      "mayanut","maya nut","maya nut tree","breadnut","bread nut","maya breadnut","mayan breadnut",
      "ramon","ramón","mayanut seed","maya nut seed","mayanut fruit","maya nut fruit",
      "mayanut flour","maya nut flour","mayanut coffee","maya nut coffee",
      "ojoche","ojoche tree","guaímaro","guaimaro","guaimaro tree","capomo","capomo tree",
      "brosimum","brosimum alicastrum","breadnut tree","maya nut powder","mayanut powder",
      "mayanut beans","maya nut beans","mayan nut","mayannut","mayan nut tree","mayan bread nut",
      "mayan breadnut tree","ramon nut","ramon seed","ojoche nut","the mayanut tree"
    ];
    const COMPANY_INFO =
      "MayaNut was founded on April 24, 2008 to ensure the survival of the Brosimum alicastrum species and to benefit humanity through its agricultural uses.";
    const TREE_INFO =
      "Brosimum alicastrum (Maya Nut / Breadnut) is in the Moraceae (fig, jackfruit, mulberry). It’s valued in modern agroforestry for productivity, drought resilience, canopy services, and nutrient-dense seeds (flour, roasted beverage, wholesome foods) that support communities and ecosystems.";

    const BUY_TRIGGERS = ["buy","product page","products","shop","purchase","order","take me to products","take me to the product page"];
    const COMPANY_TRIGGERS = ["company","about us","about mayanut","who are you","when founded"];
    const SOCIAL_TRIGGERS = ["instagram","social","social media","ig"];
    const TREE_TRIGGERS = ["tree","brosimum","brosimum alicastrum","what is mayanut","tell me about mayanut","what is breadnut","what is ramon"];

    /* ======= UI HELPERS ======= */
    const chatInput = document.getElementById("chatInput");
    const chatLog   = document.getElementById("chatLog");
    const chatBox   = document.getElementById("chatBox");
    const productPage = document.getElementById("productPage");
    const aboutPage   = document.getElementById("aboutPage");

    function say(role, html){
      chatLog.innerHTML += `<div><strong>${role}:</strong> ${html}</div>`;
      chatLog.scrollTop = chatLog.scrollHeight;
    }

    /* ======= MEMORY COMMANDS ======= */
    // remember: ..., fact: ..., teach: ...
    function addFact(text){
      MEMORY.facts.push({text:text.trim(), ts: Date.now()});
      saveMem(MEMORY);
      say("Bot","Saved that to my memory.");
    }
    // product: Name = details
    function addProduct(raw){
      const m = raw.match(/^product\s*:\s*([^=]+?)\s*=\s*(.+)$/i);
      if(!m){ say("Bot","To add a product, use: <code>product: Name = details</code>"); return; }
      const name = m[1].trim();
      const details = m[2].trim();
      MEMORY.products[name] = details;
      saveMem(MEMORY);
      renderProductsList();
      say("Bot",`Saved product <b>${name}</b>.`);
    }
    function listMemories(){
      if(!MEMORY.facts.length){ say("Bot","No memories yet."); return; }
      const html = MEMORY.facts.map((f,i)=>`${i}. ${f.text}`).join("<br>");
      say("Bot", html);
    }
    function forgetIndex(i){
      if(Number.isNaN(i) || i<0 || i>=MEMORY.facts.length){ say("Bot","Invalid memory index."); return; }
      const removed = MEMORY.facts.splice(i,1);
      saveMem(MEMORY);
      say("Bot",`Forgot: ${removed[0].text}`);
    }

    /* ======= INTENT DETECTION ======= */
    function detectIntent(text){
      const t = norm(text);
      if (/^memories$/i.test(text)) return {type:"memories"};
      const forgetMatch = t.match(/^forget\s+(\d+)$/i);
      if (forgetMatch) return {type:"forget", idx: Number(forgetMatch[1])};
      if (/^(remember|fact|teach|note that)\s*[:\-]/i.test(text)) return {type:"addFact", payload: text.replace(/^(remember|fact|teach|note that)\s*[:\-]\s*/i,"")};
      if (/^product\s*:/i.test(text)) return {type:"addProduct", raw: text};

      if (fuzzyIncludes(t, BUY_TRIGGERS)) return {type:"buy"};
      if (fuzzyIncludes(t, SOCIAL_TRIGGERS)) return {type:"social"};
      if (fuzzyIncludes(t, COMPANY_TRIGGERS)) return {type:"company"};
      if (fuzzyIncludes(t, TREE_TRIGGERS) || fuzzyIncludes(t, mayaSynonyms)) return {type:"tree"};

      const tellMatch = t.match(/^(tell me about|what is|info on|information on)\s+(.+)$/i);
      if (tellMatch){
        const subj = tellMatch[2];
        // search products
        for(const name of Object.keys(MEMORY.products)){
          if (fuzzyIncludes(subj,[name])) return {type:"productInfo", name};
        }
        if (fuzzyIncludes(subj, ["company","mayanut","mayanut company","maya nut"])) return {type:"company"};
        if (fuzzyIncludes(subj, mayaSynonyms)) return {type:"tree"};
        // search facts
        const hits = MEMORY.facts.filter(f=>fuzzyIncludes(f.text,[subj]));
        if (hits.length) return {type:"factsAnswer", hits};
      }
      return {type:"other"};
    }

    /* ======= RESPONDER ======= */
    function showProducts(){ renderProductsList(); say("Bot", productPage.innerHTML); }
    function showAbout(){ say("Bot", aboutPage.innerHTML); }

    function handle(message){
      say("You", message);

      const intent = detectIntent(message);

      switch(intent.type){
        case "memories": listMemories(); break;
        case "forget":   forgetIndex(intent.idx); break;
        case "addFact":  addFact(intent.payload); break;
        case "addProduct": addProduct(intent.raw); break;

        case "buy": showProducts(); break;
        case "social":
          say("Bot", 'Opening Instagram <a href="https://instagram.com/mayanut.co" target="_blank">@mayanut.co</a> …');
          window.open("https://instagram.com/mayanut.co","_blank");
          break;
        case "company": say("Bot", COMPANY_INFO); break;
        case "tree": {
          // Also weave core belief as guiding principle
          say("Bot", TREE_INFO + "<br><em>"+CORE_BELIEF+"</em>");
          break;
        }
        case "productInfo": {
          const info = MEMORY.products[intent.name] || "No details yet.";
          say("Bot", `<b>${intent.name}</b> — ${info}`);
          break;
        }
        case "factsAnswer": {
          const html = intent.hits.map(f=>"• "+f.text).join("<br>");
          say("Bot", html);
          break;
        }
        default:
          // Stay scoped + mention core belief gently
          say("Bot","I can help with MayaNut, Brosimum alicastrum, and related products/agroforestry. "+CORE_BELIEF);
      }
    }

    /* ======= WIRE UI ======= */
    document.getElementById("aiTab").addEventListener("click", ()=>{
      chatBox.style.display="flex"; productPage.style.display="none"; aboutPage.style.display="none";
    });
    document.getElementById("productsTab").addEventListener("click", ()=>{
      renderProductsList(); productPage.style.display="block"; aboutPage.style.display="none"; chatBox.style.display="none";
    });
    document.getElementById("aboutTab").addEventListener("click", ()=>{
      aboutPage.style.display="block"; productPage.style.display="none"; chatBox.style.display="none";
    });

    // Enter to send
    chatInput.addEventListener("keydown", e=>{
      if(e.key==="Enter"){
        const v = chatInput.value.trim();
        if(!v) return;
        chatInput.value = "";
        handle(v);
      }
    });

    // Quick action pills
    document.querySelectorAll(".pill").forEach(p=>{
      p.addEventListener("click",()=>{
        const t = p.getAttribute("data-quick");
        if(t==="buy") handle("buy");
        else if(t==="about company") handle("about company");
        else if(t==="instagram") handle("instagram");
      });
    });

    // Greet with mission once
    if(!sessionStorage.getItem("greeted")){
      say("Bot","Welcome to MayaNut AI. Ask about products, our company, or the MayaNut tree. "+CORE_BELIEF);
      sessionStorage.setItem("greeted","1");
    }
  </script>
</body>
</html>
