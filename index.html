<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MayaNut</title>
<style>
  :root{
    --ink:#eef4ff; --ink-dim:#ccdaf3;
    --panel:rgba(12,16,34,.45); --line:rgba(255,255,255,.12);
    --inputBG:rgba(255,255,255,.08); --inputLine:rgba(255,255,255,.22);

    /* Gold (lighter + more orange) */
    --gold1:#fff6b8; --gold2:#ffdf86; --gold3:#ffb967; --gold4:#ff9e4f;

    /* Clear, pale water */
    --waterC1:rgba(205,245,255,.58);
    --waterC2:rgba(170,230,255,.40);
    --waterC3:rgba(135,210,255,.28);
  }

  html,body{height:100%}
  body{
    margin:0;color:var(--ink);
    font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, sans-serif;
    display:flex; flex-direction:column; min-height:100%;

    /* Tropical, lighter-blue palette with faded pink, less purple */
    background:
      radial-gradient(1200px 600px at 55% -10%, rgba(170,224,255,.35), transparent 60%),
      radial-gradient(900px 520px at 15% 0%, rgba(255,196,220,.18), transparent 60%),
      radial-gradient(1000px 680px at 85% 10%, rgba(160,220,255,.22), transparent 65%),
      linear-gradient(180deg, #0e2a4d 0%, #164c86 45%, #195da0 100%);
    overflow-x:hidden;
  }

  /* subtle sky glow */
  .top-glow{
    position:fixed; inset:0 0 auto 0; height:38vh; pointer-events:none; z-index:-1;
    background:
      radial-gradient(60% 60% at 50% 0%, rgba(255,228,160,.28), transparent 60%),
      radial-gradient(45% 45% at 75% 6%, rgba(255,190,226,.18), transparent 60%),
      radial-gradient(55% 55% at 25% 10%, rgba(170,230,255,.22), transparent 60%);
    filter: blur(18px) saturate(112%);
  }

  /* Top bar */
  .topbar{position:fixed;top:0;left:0;right:0;z-index:30;display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:var(--panel);border-bottom:1px solid var(--line);backdrop-filter:blur(10px) saturate(140%)}
  .brand{
    font-weight:900; letter-spacing:.3px; display:flex; align-items:flex-end; gap:6px; user-select:none;
    background:linear-gradient(180deg,var(--gold1),var(--gold2) 35%,var(--gold3) 70%, var(--gold4));
    -webkit-background-clip:text; background-clip:text; color:transparent;
    text-shadow:0 10px 24px rgba(0,0,0,.25);
    font-size: 20px;
  }
  .brand small{
    font-size:12px; line-height:1; margin-left:2px;
    background:linear-gradient(180deg,var(--gold1),var(--gold2),var(--gold3));
    -webkit-background-clip:text; background-clip:text; color:transparent;
    text-shadow:0 10px 24px rgba(0,0,0,.25);
  }

  .nav{display:flex;gap:18px;align-items:center}
  .nav a{color:var(--ink);text-decoration:none;font-weight:700;font-size:14px;padding:8px 12px;border-radius:10px;border:1px solid transparent}
  .nav a:hover{border-color:var(--line);background:rgba(255,255,255,.06)}

  /* Stage */
  .stage{flex:1;display:flex;align-items:center;justify-content:center;padding-top:96px;padding-bottom:80px}
  .panel{width:min(900px,92vw);text-align:center}

  /* Transparent SVG hero logo */
  .heroLogo{ width:min(560px,80vw); margin:6px auto 16px; display:block; }

  .chatbar{display:flex;align-items:center;gap:10px;justify-content:center;margin:0 auto;width:min(760px,92vw)}
  .chatbar input{flex:1;height:42px;padding:10px 12px;font-size:15px;color:#e9eeff;background:var(--inputBG);border:1px solid var(--inputLine);border-radius:12px;outline:none}
  .chatbar input::placeholder{color:#cfeaff}
  .chatbar input:focus{border-color:rgba(143,220,255,.75);box-shadow:0 0 0 3px rgba(143,220,255,.25)}

  .log{width:min(760px,92vw);margin:12px auto 0;background:rgba(8,12,30,.5);border:1px solid var(--line);border-radius:14px;padding:12px;max-height:42vh;overflow:auto}
  .msg{text-align:left;margin:6px 0;color:#eaf2ff}
  .msg strong{color:#cfe1ff}

  /* Sections */
  .section{width:min(980px,94vw);margin:24px auto 0;background:rgba(8,12,30,.48);border:1px solid var(--line);border-radius:16px;padding:18px}
  .section h3{margin:0 0 8px;color:#fff}
  .section p{margin:8px 0 0;color:#d5e7ff}

  /* Footer + IG */
  footer{
    width:100%;color:#d5e0fb;border-top:1px solid var(--line);
    background:rgba(10,14,34,.45);backdrop-filter:blur(6px);
    display:flex; align-items:center; justify-content:center; gap:12px;
    font-size:13px; padding:12px 8px; position:relative;
  }
  .ig-link{
    position:absolute; right:14px; top:50%; transform:translateY(-50%);
    display:inline-flex; align-items:center; justify-content:center;
    width:22px; height:22px; border-radius:6px;
  }
  .ig-link svg{transition:transform .2s ease, filter .2s ease; filter:drop-shadow(0 0 0 rgba(255,255,255,0))}
  .ig-link:hover svg{transform:scale(1.08); filter:drop-shadow(0 0 8px rgba(255,255,255,.65))}

  /* FX canvas: single background renderer */
  #fx{position:fixed; inset:0; z-index:0; pointer-events:none}
</style>
</head>
<body>

<div class="top-glow"></div>

<header class="topbar" role="banner">
  <div class="brand">MayaNut<small>™</small></div>
  <nav class="nav" aria-label="Primary">
    <a href="#home" id="navHome">MayaNut</a>
    <a href="#buy"  id="navBuy">Buy</a>
    <a href="#about" id="navAbout">About</a>
    <a href="https://instagram.com/mayanut.co" target="_blank" rel="noopener">Instagram</a>
  </nav>
</header>

<!-- Background FX (one canvas) -->
<canvas id="fx"></canvas>

<main id="home" class="stage">
  <div class="panel">
    <!-- Transparent gold SVG “image” with TM closer -->
    <svg class="heroLogo" viewBox="0 0 1200 260" aria-label="MayaNut logo">
      <defs>
        <linearGradient id="goldGrad" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0%"  stop-color="#fff6b8"/>
          <stop offset="40%" stop-color="#ffdf86"/>
          <stop offset="78%" stop-color="#ffb967"/>
          <stop offset="100%" stop-color="#ff9e4f"/>
        </linearGradient>
        <filter id="softGlow" x="-20%" y="-40%" width="140%" height="180%">
          <feDropShadow dx="0" dy="8" stdDeviation="10" flood-color="rgba(0,0,0,.28)"/>
        </filter>
      </defs>
      <g fill="url(#goldGrad)" filter="url(#softGlow)">
        <text x="40" y="180" font-family="Poppins, Inter, system-ui, sans-serif" font-weight="900" font-size="180">MayaNut</text>
        <!-- TM moved ~closer to the word -->
        <text x="955" y="100" font-family="Inter, system-ui, sans-serif" font-weight="800" font-size="46">™</text>
      </g>
    </svg>

    <div class="chatbar" role="search">
      <input id="chatInput" placeholder="Type What You Want" aria-label="Type what you want and press Enter" />
    </div>
    <div class="log" id="chatLog" aria-live="polite" aria-label="Conversation"></div>
  </div>
</main>

<section id="buy" class="section" aria-labelledby="buyTitle">
  <h3 id="buyTitle">Buy</h3>
  <p>Search Through Our Wonderful Products — real items coming soon.</p>
  <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px">
    <a href="#home" style="text-decoration:none;">
      <div style="border:1px solid var(--line);border-radius:12px;padding:16px;text-align:center;background:rgba(255,255,255,.04);color:#eaf2ff;">
        Product A (placeholder)
      </div>
    </a>
    <a href="#home" style="text-decoration:none;">
      <div style="border:1px solid var(--line);border-radius:12px;padding:16px;text-align:center;background:rgba(255,255,255,.04);color:#eaf2ff;">
        Product B (placeholder)
      </div>
    </a>
    <a href="#home" style="text-decoration:none;">
      <div style="border:1px solid var(--line);border-radius:12px;padding:16px;text-align:center;background:rgba(255,255,255,.04);color:#eaf2ff;">
        Product C (placeholder)
      </div>
    </a>
  </div>
</section>

<section id="about" class="section" aria-labelledby="aboutTitle">
  <h3 id="aboutTitle">About</h3>
  <p><strong>MayaNut</strong> is a South Florida company promoting the cultivation and appreciation of
    <em>Brosimum alicastrum</em>—the Maya Nut (Breadnut). We champion sustainable agroforestry and regenerative
    farming that restores soils, supports biodiversity, and produces resilient, nutritious foods.</p>
  <p><strong>August Kokus is the current CEO of MayaNut™.</strong></p>
</section>

<footer>
  <span>© 2025 MayaNut LLC. All rights reserved.</span>
  <a class="ig-link" href="https://instagram.com/mayanut.co" target="_blank" rel="noopener" aria-label="MayaNut on Instagram">
    <!-- simple white Instagram glyph -->
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="white" aria-hidden="true">
      <path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm0 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H7zm5 3.5A5.5 5.5 0 1 1 6.5 13 5.5 5.5 0 0 1 12 7.5zm0 2A3.5 3.5 0 1 0 15.5 13 3.5 3.5 0 0 0 12 9.5zM18 6.2a1 1 0 1 1-1 1 1 0 0 1 1-1z"/>
    </svg>
  </a>
</footer>

<!-- Single FX canvas -->
<canvas id="fx"></canvas>

<script>
/* smooth nav */
document.getElementById('navHome').addEventListener('click', e=>{e.preventDefault(); document.getElementById('home').scrollIntoView({behavior:'smooth'});});
document.getElementById('navBuy').addEventListener('click',  e=>{e.preventDefault(); document.getElementById('buy').scrollIntoView({behavior:'smooth'});});
document.getElementById('navAbout').addEventListener('click',e=>{e.preventDefault(); document.getElementById('about').scrollIntoView({behavior:'smooth'});});

/* mini chat */
const input=document.getElementById('chatInput'), logBox=document.getElementById('chatLog');
function say(role, text){ const el=document.createElement('div'); el.className='msg'; el.innerHTML=`<strong>${role}:</strong> ${text}`; logBox.appendChild(el); logBox.scrollTop=logBox.scrollHeight; }
input.addEventListener('keydown', e=>{ if(e.key==='Enter'){ const t=input.value.trim(); if(!t) return; say('You',t); input.value=''; const low=t.toLowerCase(); if(low.includes('buy')){ document.getElementById('buy').scrollIntoView({behavior:'smooth'}); say('MayaNut','Opening Buy'); } else if(low.includes('about')){ document.getElementById('about').scrollIntoView({behavior:'smooth'}); say('MayaNut','Opening About'); } else { say('MayaNut','What else should we add?'); }}});

/* ===== FX: Rising dust → merging risers → fall as drops at 5 merges → splash on surface with waves. 
   - Squash & stretch on growth and on impact
   - Water fills page in ~10 minutes
   - Clear, pale water and lively background
===== */
(function(){
  const canvas=document.getElementById('fx');
  const ctx=canvas.getContext('2d');

  let W=innerWidth, H=innerHeight, DPR=Math.min(2, devicePixelRatio||1);
  function resize(){
    W=innerWidth; H=innerHeight; DPR=Math.min(2, devicePixelRatio||1);
    canvas.style.width=W+'px'; canvas.style.height=H+'px';
    canvas.width=Math.round(W*DPR); canvas.height=Math.round(H*DPR);
    ctx.setTransform(DPR,0,0,DPR,0,0);
  }
  resize(); addEventListener('resize', resize);

  // Timing
  let last = performance.now();

  // Particles
  const MAX_RISERS = 260;
  const MAX_DROPS  = 120;
  const risers = [];   // rising white specks that merge; after mass>=5 become falling drops
  const drops  = [];   // falling light-blue drops
  const ripples = [];  // surface ripple rings

  // Water target: fill in ~10 minutes
  let waterHeight = H * 0.04;           // start film
  const WATER_FILL_SECONDS = 600;       // 10 minutes
  const WATER_TARGET = H * 0.96;        // leave a tiny sliver
  const WATER_BASE_RATE = (WATER_TARGET - waterHeight) / WATER_FILL_SECONDS; // px per second
  const DROP_RISE = 0.14;               // extra rise per drop splash

  // Riser factory
  function makeRiser(x,y, mass=1){
    // squash/stretch state
    return {
      type:'riser', x,y,
      vx:(Math.random()*0.6-0.3),
      vy:-(0.22 + Math.random()*0.28),
      mass,
      r: 1.0 + Math.min(6, mass)*0.35,
      squashT:0, squashAxis:'y'
    };
  }
  // Drop factory
  function makeDrop(x,y, mass){
    const r = Math.min(11, 2 + mass*0.7);
    return {
      type:'drop', x,y,
      vx:(Math.random()*0.55-0.275),
      vy:0.25 + Math.random()*0.35,
      r,
      squashT:10, squashAxis:'y'
    };
  }

  // Seed initial risers from near the surface upward
  function seed(){
    const surfaceY = H - waterHeight;
    for(let i=0;i<220;i++){
      const y = surfaceY + Math.random()*H*0.35;
      const x = Math.random()*W;
      risers.push(makeRiser(x,y,1));
    }
  }
  seed();

  // Simple neighbor merge (sampled) for risers
  function tryMergeRisers(a,b){
    const dx=b.x-a.x, dy=b.y-a.y, R=(a.r+b.r)+5;
    if (dx*dx+dy*dy <= R*R){
      const total = a.mass + b.mass;
      a.x = (a.x*a.mass + b.x*b.mass)/total;
      a.y = (a.y*a.mass + b.y*b.mass)/total;
      a.mass = total;
      a.r = 1.0 + Math.min(6, a.mass)*0.35;
      // squash/stretch on merge “growth”
      a.squashT = 12; a.squashAxis='y';
      // small upward pull as it condenses
      a.vy -= 0.01;
      b._dead = true;
      if (a.mass >= 5){
        // becomes a falling drop
        drops.push(makeDrop(a.x, a.y, a.mass));
        a._dead = true;
      }
    }
  }

  // Click: add a ripple on the current surface
  document.addEventListener('click', (e)=>{
    const surfaceY = H - waterHeight;
    if (e.clientY >= surfaceY - 10){
      ripples.push({x:e.clientX, r:8, a:1});
    }
  });

  // Obstacles carve-out (let water flow around the content boxes)
  function obstacles(){
    const rects=[];
    const topbar=document.querySelector('.topbar'); if(topbar){ const r=topbar.getBoundingClientRect(); rects.push({x:r.left,y:r.top,w:r.width,h:r.height,rad:10}); }
    const chat=document.getElementById('chatInput'); if(chat){ const r=chat.getBoundingClientRect(); rects.push({x:r.left,y:r.top,w:r.width,h:r.height,rad:12}); }
    const log=document.getElementById('chatLog'); if(log){ const r=log.getBoundingClientRect(); rects.push({x:r.left,y:r.top,w:r.width,h:r.height,rad:12}); }
    const secIds=['buy','about'];
    secIds.forEach(id=>{ const el=document.getElementById(id); if(!el) return; const r=el.getBoundingClientRect(); rects.push({x:r.left,y:r.top,w:r.width,h:r.height,rad:16}); });
    return rects;
  }
  function rrPath(ctx,r){
    const rr = Math.min(r.rad, Math.min(r.w,r.h)/2);
    ctx.beginPath();
    ctx.moveTo(r.x+rr, r.y);
    ctx.lineTo(r.x+r.w-rr, r.y);
    ctx.quadraticCurveTo(r.x+r.w, r.y, r.x+r.w, r.y+rr);
    ctx.lineTo(r.x+r.w, r.y+r.h-rr);
    ctx.quadraticCurveTo(r.x+r.w, r.y+r.h, r.x+r.w-rr, r.y+r.h);
    ctx.lineTo(r.x+rr, r.y+r.h);
    ctx.quadraticCurveTo(r.x, r.y+r.h, r.x, r.y+r.h-rr);
    ctx.lineTo(r.x, r.y+rr);
    ctx.quadraticCurveTo(r.x, r.y, r.x+rr, r.y);
    ctx.closePath();
  }

  function step(dt){
    const surfaceY = H - waterHeight;

    // Base water rise rate (px/sec), scaled by dt
    waterHeight += WATER_BASE_RATE * dt;
    if (waterHeight > WATER_TARGET) waterHeight = WATER_TARGET;

    // RISERS (rising white droplets that merge)
    for (let i=risers.length-1;i>=0;i--){
      const p=risers[i];
      if (p._dead){ risers.splice(i,1); continue; }
      p.x += p.vx * dt*60 + Math.sin((p.y+performance.now()*0.001)*0.8)*0.02;
      p.y += p.vy * dt*60;

      // gentle horizontal wrap
      if (p.x < -20) p.x = W+20; else if (p.x > W+20) p.x = -20;

      // slow rise speed decreases slightly as heavier
      p.vy = - (0.22 + Math.random()*0.02) / (1 + p.mass*0.1);

      // squash decay
      if (p.squashT>0) p.squashT -= dt*60;

      // recycle if off the top
      if (p.y < -24){
        p.x = Math.random()*W;
        p.y = surfaceY + Math.random()*H*0.35;
        p.mass=1; p.r=1.2; p.vy=-0.22; p.vx=(Math.random()*0.6-0.3);
      }
    }

    // Merge risers (sampled)
    for (let i=0;i<risers.length;i+=3){
      const a=risers[i]; if(!a || a._dead) continue;
      for (let j=i+1;j<Math.min(i+7, risers.length); j++){
        const b=risers[j]; if(!b || b._dead) continue;
        tryMergeRisers(a,b);
      }
    }
    // cleanup
    for (let i=risers.length-1;i>=0;i--) if (risers[i]._dead) risers.splice(i,1);
    // refill
    if (risers.length < MAX_RISERS){
      const y = surfaceY + Math.random()*H*0.35;
      risers.push(makeRiser(Math.random()*W, y, 1));
    }

    // DROPS (falling)
    for (const d of drops){
      // gravity
      d.vy += 0.018 * dt*60;
      d.x += d.vx * dt*60;
      d.y += d.vy * dt*60;

      // squash decay
      if (d.squashT>0) d.squashT -= dt*60;
    }

    // drop–drop merges (coarse)
    for (let i=0;i<drops.length;i++){
      const a=drops[i]; if(!a || a._dead) continue;
      for (let j=i+1;j<Math.min(i+8, drops.length); j++){
        const b=drops[j]; if(!b || b._dead) continue;
        const dx=b.x-a.x, dy=b.y-a.y, R=a.r+b.r;
        if (dx*dx+dy*dy <= R*R){
          // merge b into a; conserve area
          const areaA=Math.PI*a.r*a.r, areaB=Math.PI*b.r*b.r, A=areaA+areaB;
          a.x=(a.x*areaA + b.x*areaB)/A;
          a.y=(a.y*areaA + b.y*areaB)/A;
          a.vx=(a.vx*areaA + b.vx*areaB)/A;
          a.vy=(a.vy*areaA + b.vy*areaB)/A;
          a.r = Math.sqrt(A/Math.PI);
          a.squashT = 12; a.squashAxis='y';
          b._dead=true;
        }
      }
    }
    for (let i=drops.length-1;i>=0;i--) if(drops[i]._dead) drops.splice(i,1);
    if (drops.length > MAX_DROPS) drops.splice(0, drops.length-MAX_DROPS);

    // Surface collision & splash
    const wave = (x)=> surfaceY + Math.sin(x*0.012 + performance.now()*0.003)*2 + Math.sin(x*0.035 + performance.now()*0.0016)*1.1;
    for (let i=drops.length-1;i>=0;i--){
      const d=drops[i];
      const yS = wave(d.x);
      if (d.y + d.r >= yS){
        // impact -> ripple + rise water + remove drop
        ripples.push({x:d.x, r:10, a:1});
        waterHeight = Math.min(WATER_TARGET, waterHeight + DROP_RISE);
        drops.splice(i,1);
      } else if (d.x<-40 || d.x>W+40){
        drops.splice(i,1);
      }
    }

    // Ripples
    for (let i=ripples.length-1;i>=0;i--){
      const r = ripples[i];
      r.r += 2.4 * dt*60;
      r.a -= 0.022 * dt*60;
      if (r.a <= 0) ripples.splice(i,1);
    }
  }

  function draw(){
    ctx.clearRect(0,0,W,H);

    const surfaceY = H - waterHeight;

    // 1) RISERS (white)
    for (const p of risers){
      let sx=1, sy=1;
      if (p.squashT>0){
        const t=Math.max(0, Math.min(1, p.squashT/12));
        const amt=0.35*Math.sin(t*Math.PI);
        if (p.squashAxis==='y'){ sy=1+amt; sx=1-amt*0.6; } else { sx=1+amt; sy=1-amt*0.6; }
      }
      ctx.save(); ctx.translate(p.x,p.y); ctx.scale(sx,sy);
      const fade = Math.max(0, Math.min(1, (p.y - (surfaceY-160)) / 240));
      const alpha = 0.28 + (1-fade)*0.38;
      ctx.fillStyle = `rgba(255,255,255,${alpha.toFixed(3)})`;
      ctx.beginPath(); ctx.arc(0,0,p.r,0,Math.PI*2); ctx.fill();
      ctx.restore();
    }

    // 2) DROPS (light cyan, glossy)
    for (const d of drops){
      let sx=1, sy=1;
      if (d.squashT>0){
        const t=Math.max(0, Math.min(1, d.squashT/12));
        const amt=0.40*Math.sin(t*Math.PI);
        if (d.squashAxis==='y'){ sy=1+amt; sx=1-amt*0.55; } else { sx=1+amt; sy=1-amt*0.55; }
      }
      ctx.save(); ctx.translate(d.x,d.y); ctx.scale(sx,sy);
      const grad = ctx.createRadialGradient(0, -d.r*0.45, d.r*0.25, 0, 0, d.r*1.1);
      grad.addColorStop(0, 'rgba(230,250,255,0.96)');
      grad.addColorStop(1, 'rgba(160,220,255,0.74)');
      ctx.fillStyle=grad;
      ctx.beginPath(); ctx.ellipse(0, 0, d.r, d.r*1.1, 0, 0, Math.PI*2); ctx.fill();
      ctx.fillStyle='rgba(255,255,255,0.5)';
      ctx.beginPath(); ctx.arc(-d.r*0.35, -d.r*0.55, Math.max(0.8, d.r*0.25), 0, Math.PI*2); ctx.fill();
      ctx.restore();
    }

    // 3) WATER BODY (clear & pale)
    const g = ctx.createLinearGradient(0, surfaceY, 0, H);
    g.addColorStop(0.00, 'var(--waterC1)');
    g.addColorStop(0.55, 'var(--waterC2)');
    g.addColorStop(1.00, 'var(--waterC3)');
    ctx.fillStyle=g;
    ctx.fillRect(0, surfaceY, W, H-surfaceY);

    // WAVE LINE (live)
    ctx.beginPath();
    for (let x=0;x<=W;x+=5){
      const y = surfaceY + Math.sin(x*0.012 + performance.now()*0.003)*2 + Math.sin(x*0.035 + performance.now()*0.0016)*1.1;
      if (x===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    }
    ctx.strokeStyle='rgba(255,255,255,0.45)';
    ctx.lineWidth=1.4;
    ctx.stroke();

    // RIPPLE RINGS
    for (const r of ripples){
      const y = surfaceY + Math.sin(r.x*0.012 + performance.now()*0.003)*2 + Math.sin(r.x*0.035 + performance.now()*0.0016)*1.1;
      ctx.strokeStyle = `rgba(255,255,255,${(0.55*r.a).toFixed(3)})`;
      ctx.lineWidth=1;
      ctx.beginPath(); ctx.ellipse(r.x, y, r.r, r.r*0.55, 0, 0, Math.PI*2); ctx.stroke();
    }

    // FLOW AROUND CONTENT: carve out rectangles so water doesn’t overlap them
    ctx.globalCompositeOperation='destination-out';
    const obs = obstacles();
    for (const r of obs){ rrPath(ctx,r); ctx.fillStyle='rgba(0,0,0,1)'; ctx.fill(); }
    ctx.globalCompositeOperation='source-over';
  }

  function loop(now){
    const dt = Math.min(0.05, (now - last)/1000); // clamp dt
    last = now;
    step(dt); draw();
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
